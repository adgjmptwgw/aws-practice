# 概要
コンソール上で「Application Load Balancerを作成」を実施する際の各種項目を解説する。  

# 前提知識
## SSLアクセラレータ
HTTPSの通信を暗号/復号化するもの。ALBではHTTPS通信を復号化して、HTTP通信でVPC内のパブリックサブネットに通信します。
![image](https://github.com/adgjmptwgw/aws-practice/assets/66456130/62499d92-bd2b-4c9d-a81a-abfc6a98e5fb)

## スティッキーセッション（グループレベルの維持設定）
- ALB作成後、「リスナーとルール 」を設定を編集する際に、「グループレベルの維持設定」というものがあり、これはスティッキーセッションに関しての設定の事である。
- スティッキーセッションとは、セッションが続いている間は同じロードバランサーにトラフィックを割り振るもの。
- どこへロードバランシングされるかどうかはCookieに情報が保存されている。ユーザーはCookieの情報を元に同じサーバーへアクセスできる（トラフィックが転送される）。  

**<メリット>**  
- アプリでセッションを使用する場合、ALBを使用するとセッションが切れやすくなる？？？？　そうならない為に使用する？？？？

**<デメリット>**  
- Auto Scaling でスケールアウトされた新たなEC2インスタンスにはトラフィックが分散されない。スティッキーキャッシュが切れるまで、トラフィックが分散されない。
- リクエストのロードバランシングで偏りが生じる

[**スティッキーキャッシュのデメリット**](https://dev.classmethod.jp/articles/stateless_ec2/)


# 手順
## 基本的な設定
1. **ロードバランサー名**
2. **スキーム**
  - インターネット向け
    - インターネットからのトラフィック（Rest APIの通信等）を捌くときに使用する。
    - ほとんどの場合、こちらを選択する。
  - 内部向け
    - Privateサブネット内で完結する処理をALBで分散したいときに使用
    - 下記の画像は参考のインフラ構成

![image](https://github.com/adgjmptwgw/aws-practice/assets/66456130/c1cdd7a5-e514-422c-8b1e-498158322a3c)

3. **IPアドレスタイプ**  
ALBからトラフィックをVPCにトラフィックを転送する際の転送先（Privateサブネット）のIPアドレスタイプを選択する。

   - IPv4
     - VPCとサブネットでIPv4のみのIPアドレスを使用している場合、こちらを選択
   - Dualstack
     - VPCとサブネットには、IPv6 CIDR ブロックが使用されている場合はこちらを選択する可能性あり
     - デュアルスタックの手順は知らないので、余裕があれば調べる。サブネットのルートテーブルでIPv6トラフィックをルーティング、セキュリティグループで、IPv6トラフィックを許可する等の対応が必要らしい。

## ネットワークマッピング
1. **VPC**  
ALBはIPアドレス設定に従って、選択したサブネットのターゲットにトラフィックをルーティングします。
基本的にはパブリックネットワークと紐づけます。
3. **マッピング**  
トラフィックを送信するVPCとAZを選択する

# 作成後

[ALBのDNS名にドメインを割り当てる](https://dev.classmethod.jp/articles/route53-alias-crossaccount/)





***

**ルーティングポリシー**  
[ルーティングポリシーの記事](https://o2mamiblog.com/aws-route53-routingpolicy-beginner/#toc2)


**リスナー**  
ALBにアクセスするプロトコルとポート（またはIPアドレス）に対して、どのターゲットグループで処理を捌くかコントロールする。

**AWS Global Accelerator**  
[AWS Global Acceleratorの記事](https://qiita.com/Dai_Kentaro/items/c25aed800e8d6cfd1f18)

