# 概要
コンソール上で「レジストリ」に関する際の各種項目を解説する。

# 前提知識
## レジストリとは
- レポジトリ（イメージ）を保存するもの
- パブリックレジストリ / プライベートレジストリ がAWSアカウントにつき、それぞれ1つずつ存在する。

![image](https://github.com/adgjmptwgw/aws-practice/assets/66456130/6964a0a5-2536-418e-97c7-fbefa8002452)

# 各項目
---
# レジストリのアクセス許可
主に下記のアクセス権を管理、設定する。
- 特定のAWSアカウントからのレプリケーションの許可
- プルスルーキャッシュのポリシーを設定
- 特定のユーザーのみ、レジストリにイメージをpushする許可
  （AWSにアクセスするユーザー自体に各種権限を設ける場合、そちらでレジストリへのアクセス権限を設定する。2重管理となる為、こちらでは設定しない？？？）

# プルスルーキャッシュ設定

[プルスルーキャッシュの分かりやすい記事](https://dev.classmethod.jp/articles/ecr-pull-through-cache-repositories/)

# レプリケーション設定
- 例えば、stg環境のAWSアカウントにイメージをpushした際、別アカウントである本番用のAWSアカウントの特定のレポジトリへ同じ内容のイメージをレプリケーションしてくれる。
- 環境変数を設定したい場合、Dockerfileに環境変数を記述し、ECSの「タスクの定義 > コンテナ > 環境変数」の箇所でコントロールする？？

# Scanning（スキャン設定）
## スキャンタイプ
### 基本スキャン
- イメージがPushされたタイミング or 手動でにて任意のタイミングでAmazon Inspector の脆弱性診断を実施する
- 料金は無料

### 拡張スキャン
- 連続スキャンを実行。連続スキャンとは、イメージがPushされたタイミングに加え、Amazon Inspector の脆弱性データベースの更新が行われるたびに自動的にイメージスキャンを実行すること。
- 手動スキャンが実行できない。
- プログラミング言語(python,Ruby,Java, JSなど)のパッケージ(ライブラリなど)に関する脆弱性も診断できる。
- 料金は有料
  - 継続的なスキャン（連続スキャン）を1回実行 => 0.01 USD
  - プッシュ1回ごとのスキャン => イメージごとに 0.11 USD （東京リージョンの価格）
  - [AWS公式 Inspector料金](https://aws.amazon.com/jp/inspector/pricing/)  

**<スキャンの違い>**
![image](https://github.com/adgjmptwgw/aws-practice/assets/66456130/7ceb0be1-2d30-4611-b4b5-83f0abcab47d)


## プッシュフィルターのスキャン（基本スキャン用） or 連続スキャンフィルター（拡張フィルター用）
特定のレポジトリにのみスキャンを実行したい場合、こちらでフィルターをかけられる。  
レポジトリ名に対して、一致する文字列のレポジトリにのみ脆弱性診断を実行する。ワイルドカード等である程度カスタマイズできる。
[AWS公式 脆弱性スキャンのリポジトリフィルター](https://docs.aws.amazon.com/ja_jp/AmazonECR/latest/userguide/image-scanning.html)  



