# 概要
コンソール上で「ボールトの作成」「バックアップ保管庫の作成」「バックアッププランを作成 」を実施する際の各種項目を解説する。  

# 前提知識
## Backup作成の流れ
1. ボールトの作成
2. バックアッププランを作成
3. リソースの選択

## AWS Backupの使用用途
東京リージョンのバックアップを作成し、大阪リージョンのAWS Backupボールトにバックアップを保存する。  
もし東京リージョンに大きな障害があって、RDSのデータ等が正常でなくなった場合、大阪リージョンのバックアップを東京リージョンに持ってきて、復旧できる？？？？？

## RDSのRPO/RTOとは
### RPO
- あるバックアップの「ポイント」までデータを復旧させる事

## RTO
- ある「時間」までデータを復旧させる事

## 増分バックアップ
- AWS Backupでバックアップする際はバックアップするサービスにもよるが、基本は増分バックアップ。  
その為、2回目以降のバックアップに要する時間は短くなる。
- 増分バックアップを実行するには、ウォームバックアップを1つ以上置いておく必要がある。もし1つもなければ、フルバックアップになってしまう。（[**参考記事**](https://docs.aws.amazon.com/ja_jp/aws-backup/latest/devguide/creating-a-backup-plan.html)）

**<参考資料>**  
- [**増分バックアップ**](https://docs.aws.amazon.com/ja_jp/aws-backup/latest/devguide/whatisbackup.html)

**<参考資料>**  
- [**RPO/RTOとは**](https://sayjoyblog.com/rpo-rto/)

# 各種項目
# ボールトの作成
TBD

# ボールトロックを作成
## ボールトロックモード
### ガバナンスモード
- 復旧ポイントを削除できなくする。
- 管理画面でガバナンスモードを外せば、削除が可能な為、うっかり削除防止のモード。

### コンプライアンスモード
- 復旧ポイントを削除できなくする。
- クーリングオフ期間以降は ボールトロックを管理または削除することが不可能。クーリングオフ期間はコンプライアンスモードの開始日が起点となる。

**<参考記事>**  
- [**ボールトロックモードについて**](https://blog.serverworks.co.jp/2022/12/29/104659z)


# バックアッププランを作成
## バックアップ期間
### start within（内から始める）
- 何時間以内にAWS Backupを始めるか設定できる
- 下記のような事がある為、この項目を設定する必要がある。また、下記のイベントを避けて、バックアップのタイミングを自動でスケジューリングしてくれる。
  - RDSの自動バックアップ4時間前になると、AWS Backupは開始できなくなる。  
※**注：ただしAuroraの場合は制限が無い為、バックアップ時間が重複しても問題ない**
  - メンテナンス期間の開始1時間前からメンテナンス終了まではバックアップが開始されない。
- AWS Backupはバックアップするサービスにもよるが、増分バックアップのサービスが多いので2回目以降のバックアップに要する時間は短くなる。

**<参考資料>**  
- [**AWS公式：AWSメンテナンスに伴うAWS Backupの注意点**](https://docs.aws.amazon.com/aws-backup/latest/devguide/creating-a-backup-plan.html?icmpid=docs_console_unmapped)
- [**AWS公式：RDSバックアップに伴うAWS Backupの注意点**](https://repost.aws/questions/QUv-o_oIQoTnSRRQtcb22nGQ/aws-backup-policy-and-retention)

## ポイントインタイムリカバリ 
### PITRの為に継続的なバックアップを有効化
- 最大35日前の特定の時刻にRDSのデータを巻き戻すことができる機能。1秒単位で戻れる。
- 通常の自動バックアップとの違い
  - 通常のRDS自動バックアップは1日1回のスナップショット分の復元が可能（自動バックアップ）
  - こちらは継続バックアップの為、1 秒以内の精度で選択した特定の時刻に巻き戻すことで復元が可能（継続的なバックアップ）
- 初めて有効化すると、バックアップボールトが作成される。既存のバックアップボールトがあれば、ボールトは作成されない。

![image](https://github.com/adgjmptwgw/aws-practice/assets/66456130/636f1844-f512-4e73-b561-085bb585fcb4)



**<参考資料>**  
- [**AWSBackupを用いたAuroraのバックアップ復元**](https://dev.classmethod.jp/articles/update-aws-backup-aurora-point-in-time-restore/)

# その他
## S3のバックアップ範囲について
- バージョニングの場合、バックアップを実行した際の最新のバージョンのみをバックアップする。復元の際は最新バージョンのみ復元する。

**<参考資料>**  
- [**S3のバージョニングはバージョニング構造ごと復元するのか**](https://www.cloudbuilders.jp/articles/984/)

