# 概要
コンソール上で「VPCの作成」を実施する際の各種項目を解説する。  

# 前提知識
## NAT Gateway
### 機能
- 「プライベートサブネット → インターネット」へアクセスしたい場合に使用する。
- 「インターネット → プライベートサブネット」方向はアクセスできない為、セキュリティーを担保した状態でインターネット通信が可能。

### ユースケース
- インストール、アップデートを行う際にインターネットへアクセスする際
- CloudWatchメトリクスを送信するとき
- etc...

## IPv6
### 概要
インターネットに接続された端末（パソコンやスマホ等）を識別する番号(IPアドレス)が足りなくなったことで、新たな端末に割り振りができなくなるというIPアドレス枯渇問題がある。
そこで新たに登場したプロトコルがIPv6。事実上ほぼ無限である為、IPアドレスの不足が解消されると言われている。

# 手順（VPCとその他リソースを一括作成手順）
「作成するリソース」で「VPCなど」を選択した場合の手順を記載。

## 1. 作成するリソース
「VPCなど」を選択

**VPCなど**
- VPCに付随して、サブネットやNAT Gatewayを作成してくれる。命名規則も深く考えずに済むため便利。
- カスタマイズ性は高くない為、サブネットとNat Gateay / Internet Gatewayを任意に設定したい場合はルートテーブルを後で設定する。

## 2. 名前タグの自動生成
プリフィックスを入力する。サブネットやNAT Gateway自動生成時の命名に使用される。

## 3. IPv4 CIDR ブロック
- 下記のプライベート IPv4 アドレス範囲から作成する。この範囲外だとセキュリティーリスクやELB接続の際に不都合が生じる。
- 各サブネットで使用可能なIPアドレスの範囲が被らないように設定する。下記のサイトにある「サブネットマスク計算」で「使用可能IP」が被らないように設定する。
  - [**サブネットマスク計算**）](https://note.cman.jp/network/subnetmask.cgi)

| プライベートIPアドレス（RFC 1918）の範囲 | CIDR ブロックの例 |
| ---- | ---- |
| 10.0.0.0 – 10.255.255.255 | 10.0.0.0/16 |
| 172.16.0.0 – 172.31.255.255 | 10.0.0.0/16 |
| 192.168.0.0 – 192.168.255.255 | 10.0.0.0/16 |

**<参考資料>**   
[CIDRブロック設定について（AWS公式）](https://docs.aws.amazon.com/ja_jp/vpc/latest/userguide/vpc-cidr-blocks.html)


## 3. IPv6 CIDR ブロック
- パブリックIPv4の枯渇、特に大規模ネットワーク内でのプライベートIPv4の不足を理由にIPv6を使用する場合がある
- IPv6のみの運用 or デュアルスタック（IPv4/IPv6の両方を設定する）も設定できる。現時点ではそこまでメリットはない？？？   
※今後調査して、追記します。

## 4. テナンシー  
セキュリティ的なリスクは「デフォルト」「専有」のどちらも変わらない

**デフォルト（共有）**
- 物理サーバーを複数ユーザで共有する
- ほとんどの場合、こちらを使用する  
![image](https://github.com/adgjmptwgw/aws-practice/assets/66456130/20149e25-7b13-4b0e-ad92-8307e042b89d)  

**専有**
- 物理サーバーを1ユーザーで専有する
- 物理サーバーを専有する為、料金が高い  
![image](https://github.com/adgjmptwgw/aws-practice/assets/66456130/b8a6c402-400a-48dd-bde5-c7e6832eb36b)  

## 5. アベイラビリティゾーン (AZ) の数
  - リードレプリカを行う場合、2つ必要
  - OpenSearch の Multi-AZ with Standby の構成にする場合はAZが3つ必要

## 6. パブリックサブネットの数
TBD

## 7. プライベートサブネットの数
TBD

## 8. NAT ゲートウェイ 
- 1つのNATを2つのAZで共有している場合、NATを設定した方のAZが停止したらNATも停止してしまう。リードレプリカにする場合、NATもそれぞれのAZ毎に設定するのが推奨されている。
- 毎時料金がかかる

## 9. Egress Only インターネットゲートウェイ
TBD

## 10. VPC エンドポイント
TBD

***


# 手順（VPC / サブネット / IGW Gateway / NAT Gateway / ルートテーブルを個別で作成）

## 1. VPC作成

### 1. 作成するリソース
「VPCのみ」を選択

**VPCのみ**
- VPCのみ作成する為、手動で1つ1つサブネットやNAT Gatewayを追加する必要がある。
- 「VPCのみ」作成する場合は下記の手順
1. VPC
2. サブネット
3. Internet Gateway <br>
**※ Internet GatewayをVPCにアタッチする。先にアタッチしないとNat Gateway作成時に「failed」となり作成に失敗する** <br>
4. Nat Gateway
5. ルートテーブル

### 2. IPv4 CIDR ブロック、IPv6 CIDR ブロック、テナンシー
「手順（VPCとその他リソースを一括作成手順）」の項目を参照


## 2. サブネット作成
TBD

## 3. Internet Gateway作成
1. 名前を入力して、作成
2. 作成したInternet Gateway詳細画面で、「アクション」 > 「VPCにアタッチ」を選択
※これをしないとNAT Gatewayを作成できない。NAT Gatewayを作成してもfailedになっていまう。

## 4. NAT Gateway作成
TBD

## 5. ルートテーブル作成
- 「ルート」タブ >「ルートを編集」ボタンをクリックし、送信先を設定
- 「サブネットの関連付け」タブ > 「サブネットの関連付けを編集」ボタンをクリックして、対象のサブネットを選択
