# 概要

# 前提知識
<img src="https://github.com/adgjmptwgw/infra-note/assets/66456130/01f86a9a-9ccf-40b4-84d3-fdd0a54fa66e" width="60%">

## ワーカー
ワーカー内のエグゼキューターにタスクを処理させる。  
インスタンスタイプを選択でき、インスタンスタイプにより、DPU数も異なる。IPアドレスはDPU数にも依存する。（```IPアドレス数 = DPU数 * ジョブ実行数```）

## エグゼキューター
- エグゼキューターはSparkコードを実行する。
- ワーカーごとに1つのエグゼキューターとなる。（[**AWS公式：参考資料**](https://docs.aws.amazon.com/ja_jp/glue/latest/dg/aws-glue-api-jobs-job.html)）

**<参考資料>**
- [**AWS公式：エグゼキューター/ドライバーについて**](https://qiita.com/taka_yayoi/items/31190da754106b2d284e)

## ドライバー
処理全体を統括するプロセス。

## ジョブ / タスク
![image](https://github.com/adgjmptwgw/infra-note/assets/66456130/f70e8aa5-6939-4d2f-9169-c12af3597566)

# 手順
【ジョブの作成】
Glueはワーカーノードでジョブを実行します。
ジョブ作成時にスペック（ワーカーノードのDPU数、CPU、メモリの大きさの設定）を設定できます。

<前提>
「Visual with a source and target」にて作成

<各種オプション>
- IAM Role
  - 
- Glue version
  - 基本的に最新バージョンを使用する。
  - バージョン次第では使用できない機能がある。
- Worker type
  - ワーカーノードのスペック（DPU数、CPU、メモリの大きさの設定）を設定できます。
- Automatically scale the number of workers
  - 負荷が増えた際に自動でワーカーノードの数を増やします。上限はジョブ作成後に設定可能となります。
  - このオプションを有効にすると、「Requested number of workers」の項目が「Maximum number of workers」となり、オートスケーリング時の最大ワーカーノード数の設定に変化します。
- Requested number of workers
  - ワーカーノードの数が増えると、増えた分の倍率で料金が加算されます。
  - 最小の設定値は 2
- Job bookmark
  - S3やRDSからデータを抽出する際、前回処理したレコードは処理しない。（プライマリーキーで判断している）
  - 下記のURLの資料が分かりやすいです。
  https://pages.awscloud.com/rs/112-TZM-766/images/AWS-Black-Belt_2023_AWS-Glue_0331_v1.pdf
- Flex execution
  - 予備のコンピューティングリソース（メモリ容量、ハードウェア容量、CPUの処理速度）を用いてジョブを実行する。
  - 予備なので、リソースが無い場合は確保できるまでジョブ開始されない。
  - 主に開発や優先度が低い夜間実行時に用いられる。
  - 設定どおりのワーカー数で実行できない場合がある。
  - ジョブの料金が 1DPU/hour あたり $0.44 => $0.29 に削減される。
- Number of retries
  - ジョブ失敗時のリトライ回数を設定できる。
- Job timeout (minutes)
  - ジョブの最大実行時間。デフォルトで2880分（48時間）に設定されている。
