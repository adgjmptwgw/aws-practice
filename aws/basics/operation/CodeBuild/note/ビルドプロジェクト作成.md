# 概要
コンソール上で「ビルドプロジェクト作成」を実施する際の各種項目を解説する。

# 各種設定
## ソース
### 追加設定
- **Git のクローンの深さ**
  - クローン時に取得する、コミットの最新履歴からのバージョン数の上限を指定します。
  - コミットされた最新バージョンの数を指定。最新は1で、直前のコミットは2と順次続く。

## 環境
### 環境イメージ
- **コンピューティング**  
CodeBuild は実行されると何らかのコンピューティングリソースを起動し、buildspec.yml という構成ファイルに記述された内容に従ってコマンドなどの実行を行う仕組みとなっています。
  - Lambda
    - EC2より速い
    - 15分を超えるとタイムアウトする 
  - EC2
    - TBD
   
### サービスロール
「新しいサービスロール」にて、デフォルトのCodeBuild関連のIAMポリシーが自動生成され、ここで作成したロールにアタッチされる。  
それだけではECRへのアクセス権はない為、下記のポリシーを作成して、このロールにアタッチする。
これでECRにプッシュできる。

```
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "ecr:CompleteLayerUpload",
                "ecr:GetAuthorizationToken",
                "ecr:UploadLayerPart",
                "ecr:InitiateLayerUpload",
                "ecr:BatchCheckLayerAvailability",
                "ecr:PutImage"
            ],
            "Resource": "*"
        }
    ]
}
```


### VPC
buildspecファイルでRDSに接続する必要がある場合、プライベートサブネットにVPCを設置する。

<img src="https://github.com/adgjmptwgw/infra-note/assets/66456130/b42c61dc-d6a9-4528-81b0-9fab6652c286" width="60%">
