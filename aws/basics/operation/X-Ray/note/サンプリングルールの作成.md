# 概要
コンソール上でサービスの「サンプリングルールの作成」を実施する際の各種項目を解説する。

# 前提知識
## X-Rayのサンプリングルールとは
アプリのトレースをサンプリングし、X-Rayに記録しているが、そのサンプリングレートを変更できる。
X-Rayではサンプリングの料金が高い為、料金を低く抑えるにはサンプリングレートを低めに設定する。しかし、その分精度が低下する。  
デフォルトでは1秒につき1トレースはレートに関わらずに記録し、それを超える分は5%を取得する。

# コンソール画面
## サンプリングルール一覧画面
<details>
<summary>画像</summary>

![image (3)](https://github.com/adgjmptwgw/infra-note/assets/66456130/e0dfa9d1-a1f6-44c9-9b57-00046dc77644)

</details>

## サンプリングルール作成画面
<details>
<summary>画像</summary>

![image](https://github.com/adgjmptwgw/infra-note/assets/66456130/352b3eab-5e0c-4b40-9096-8a8a25be3738)
![image (1)](https://github.com/adgjmptwgw/infra-note/assets/66456130/5382bebe-3274-4bf0-b5ea-b8087385d333)
![image (2)](https://github.com/adgjmptwgw/infra-note/assets/66456130/f70b5069-0734-4a50-be1e-9a0004b6e35a)

</details>



# 各項目の設定
## ルールの情報
### 優先度
- 低いルールが優先される
- デフォルトルールの優先度は10000

## 制限
### リザーバサイズ
- 1秒当たりにサンプリングするリクエスト数
- サンプリングのレートに関わらず、1秒間に必ず取得するリクエスト数
- ここで設定した値を超えると「固定レート」で設定した割合でサンプリングが開始される

### 固定レート
- サンプリングする際のレート
- 単位は%

## 一致基準
ここで設定した全ての条件に一致したトレースのみを取得する。
