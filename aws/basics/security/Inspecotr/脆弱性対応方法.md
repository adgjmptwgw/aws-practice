# 各サービス毎の脆弱性対応

## EC2の場合

### dnfの一覧を取得、検索
```--installed```インストールされているものだけを表示
```linux
dnf list --installed | grep -i <検索したいパッケージ名>
```
### dnfのパッケージ最新バージョン確認
現在検索対象のパッケージがどのバージョンまでリリースされているか確認（検索したパッケージが既に最新であれば何も表示されない）
```linux
dnf check-update | grep -i <検索したいパッケージ名>
```  
**※ kernel のアップグレードを実施する場合の注意点**  
kernel をアップグレードしても最新バージョンがすぐには使用されず、古いバージョンを使用し続ける為、注意。適用するにはEC2を再起動する必要がある。  
現在使用している kernel バージョンを確認するコマンド  
```
uname -r
```

### dnfパッケージのアップデート
スーパーユーザー権限で実行する。  
```linux
sudo dnf upgrade <パッケージ名>
```

## ECRの場合
- 基本的にDockerfileを修正
  - nodeバージョン変更
  - パッケージのバージョン変更（apt, yum等）
  - ライブラリのバージョン変更（Node.jsの場合、package.json）
    - 依存関係のあるライブラリが脆弱性診断に引っかかっていた場合、依存関係を確認（```npm ls```コマンドを使えばツリー上で依存関係の確認が可能）
    - 依存関係のツリーで一番上にあるライブラリをアップデートする。場合によっては一度アンインストールしてから、再度インストールする。
- ECRリポジトリ内の古いイメージは削除しない限り、Inspecotrの脆弱表示が継続する為、削除してしまうのが望ましい。